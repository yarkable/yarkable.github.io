---
layout: post
title: ssh端口转发穿越多重跳板机的方法
subtitle: 
date: 2022-01-16
author: kevin
header-img: img/green-bg.jpg
catalog: true
tags:
    - linux
    - security
    - computer network
---



## preface 



TODO

 

本地端口转发就是访问本地端口的流量通过 ssh 被转发到远程机器上，常见情景是本地通过一个公网跳板机访问内网的服务器，可以直接将本地一个端口通过跳板机与目标机的端口进行绑定，访问本地的端口就等于在访问目标机器。



远程端口转发就是访问远程端口的流量通过 ssh 被转发到本地上，常见情景是本地 (内网) 有一个服务，需要映射到公网被人访问，所以将公网的一个端口与本地的服务端口映射起来，然后通过访问远程的端口就可以访问到内网的服务。（默认关闭，要开启）



- 不能使用 VPS (sshd server) 已占用的 `22` 端口，用作端口转发。选用 **未使用** 端口(比如 `2222`)
  否则就杯具了：`Warning: remote port forwarding failed for listen port 22`

注意要 Gatewayforward yes，否则就 BBQ 了，

netstat -lntp | grep PORT

lsof -i:PORT

如果远端机是 127.0.0.1:PORT 的话就说明只能他本地访问，要 0.0.0.0:PORT 才能够使所有的 IP 都能访问



是 sshd_config 不是 ssh_config，然后是重启 systemctl restart sshd，因为是服务端重启，ssh-daemon



动态端口转发就是开启一个 socks 代理，通过代理服务器连接它所能够连接到的任何机器，（比如我没网络他有网络），不限定某一个机器



proxifier





![Diagram: SSH port forwarding visualized](http://www.dirk-loss.de/ssh-port-forwarding.png)

![Diagram: SSH port forwarding visualized](http://www.dirk-loss.de/ssh-port-forwarding.png)



关闭连接的方法说一下



## reference



[利用SSH隧道构建多级Tunnel （非常棒）](https://zhuanlan.zhihu.com/p/94624842)

[SSH 通过跳板机直接访问内网机器 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/74193910)

[彻底搞懂SSH端口转发命令（非常棒）](https://zhuanlan.zhihu.com/p/148825449)

[mobaxterm多层隧道的配置](https://blog.csdn.net/funnyPython/article/details/122055449)

[Proxifier 4.07 破解版 - 最强大的代理客户端 | Nite07的小窝](https://www.nite07.com/proxifier/)

[SSH 端口转发 - SSH 教程 - 网道 (wangdoc.com)](https://wangdoc.com/ssh/port-forwarding.html)

[SSH 远程端口转发 | 小马过河 (lvii.github.io)](https://lvii.github.io/system/2013-10-08-ssh-remote-port-forwarding/)

[Dirk Loss: SSH Port Forwarding visualized (dirk-loss.de)](http://www.dirk-loss.de/ssh-port-forwarding.htm)

[【秒懂】5分钟学会SSH端口转发，远程工作用得着 | 如何充分利用云服务器_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1C7411P7Er?spm_id_from=333.999.0.0)

